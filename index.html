<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial Clinico</title>
     <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <!-- LOGIN -->
<div id="login">
  <h1>Acceso autorizado</h1>
  <input type="email" id="email" placeholder="Email"><br><br>
  <input type="password" id="password" placeholder="ContraseÃ±a"><br><br>
<button id="btnLogin" type="button">Ingresar</button>
<p id="error"></p>

</div>

<!-- APP -->
<div id="app" style="display:none;">
  <h1>Historial ClÃ­nico</h1>
  <p class="subtitulo">SeleccionÃ¡ un paciente</p>

  <button id="btnLogout">Cerrar sesiÃ³n</button>

  <br><br>
  
 <div class="buscador-container">
  <input
    type="text"
    id="buscador"
    placeholder="Buscar pacienteâ€¦"
    onkeyup="filtrarPacientes()"
  >
</div>

  <div id="lista" class="grid">
  <div class="card" data-id="1">Paciente 1</div>
  <div class="card" data-id="2">Paciente 2</div>
  <div class="card" data-id="3">Paciente 3</div>
  <div class="card" data-id="1">Paciente 4</div>
  <div class="card" data-id="2">Paciente 5</div>
  <div class="card" data-id="3">Paciente 6</div>
   <div class="card" data-id="1">Paciente 7</div>
  <div class="card" data-id="2">Paciente 8</div>
  <div class="card" data-id="3">Paciente 9</div>
  <div class="card" data-id="1">Paciente 10</div>
  <div class="card" data-id="2">Paciente 11</div>
</div>

</div>

    <div class="card" onclick="abrirPaciente(11)">Paciente 11</div>
  </div>

  <div id="editor" class="editor" style="display:none;">
    <h1 id="titulo"></h1>
    <p id="fecha" style="font-size:14px; color:gray;"></p>

    <textarea id="texto" disabled></textarea>

    <div class="botones">
      <button onclick="editar()">Editar</button>
      <button onclick="guardar()" id="btnGuardar" disabled>Guardar</button>
      <br><br>
      <button onclick="exportarPDF()">ğŸ“„ Descargar PDF</button>
      <button onclick="volver()">â† Volver</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCTvanae1ksxlApSyzR5aVDKz0ES5H_tug",
    authDomain: "historial-clinico-e7239.firebaseapp.com",
    projectId: "historial-clinico-e7239"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  document.getElementById("btnLogin").addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("Login OK");
    } catch (e) {
      document.getElementById("error").innerText =
        "Acceso denegado: datos incorrectos";
    }
  });

  import { onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

onAuthStateChanged(auth, (user) => {
  if (user) {
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
  } else {
    document.getElementById("login").style.display = "block";
    document.getElementById("app").style.display = "none";
  }
});

// BOTÃ“N CERRAR SESIÃ“N
document.getElementById("btnLogout").addEventListener("click", async () => {
  await signOut(auth);
});

// CLICK EN PACIENTES
document.querySelectorAll(".card").forEach(card => {
  card.addEventListener("click", () => {
    const id = card.dataset.id;
    abrirPaciente(id);
  });
});

</script>

</body>
</html>